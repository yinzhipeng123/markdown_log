

# ps命令

ps命令来自于英文词组”process status“的缩写，其功能是用于显示当前系统的进程状态。使用ps命令可以查看到进程的所有信息，例如进程的号码、发起者、系统资源使用占比（处理器与内存）、运行状态等等。帮助我们及时的发现哪些进程出现”僵死“或”不可中断“等异常情况。

**语法格式：**ps [参数]

### **常用参数：**﻿

ps接受以下几种选项：

1. UNIX 选项，可以分组，并且前面必须有一个破折号。
2. BSD 选项，可以分组，不能与破折号一起使用。
3. GNU长选项，前面有两个破折号。

不同类型的选项可以自由混合，但也会出现冲突。有一些同义选项。详见https://man7.org/linux/man-pages/man1/ps.1.html

| -a                                      | 显示所有终端机下执行的程序，除了阶段作业领导者之外           |
| --------------------------------------- | ------------------------------------------------------------ |
| a                                       | 显示现行终端机下的所有程序，包括其他用户的程序               |
| -A                                      | 显示所有程序                                                 |
| -c                                      | 显示CLS和PRI栏位                                             |
| c                                       | 列出程序时，显示每个程序真正的指令名称，而不包含路径，选项或常驻服务的标示 |
| -C <指令名称>                           | 指定执行指令的名称，并列出该指令的程序的状况                 |
| -d                                      | 显示所有程序，但不包括阶段作业领导者的程序                   |
| -e                                      | 此选项的效果和指定”A”选项相同                                |
| e                                       | 列出程序时，显示每个程序所使用的环境变量                     |
| -f                                      | 完整格式列表。与-L一起使用时，将添加NLWP（线程数）和LWP（线程ID）列 |
| f                                       | 用ASCII字符显示树状结构，表达程序间的相互关系                |
| -F                                      | 额外完整格式                                                 |
| -g <群组名称>                           | 此选项的效果和指定”-G”选项相同，当亦能使用阶段作业领导者的名称来指定 |
| g                                       | 显示现行终端机下的所有程序，包括群组领导者的程序             |
| -G <群组识别码>                         | 列出属于该群组的程序的状况，也可使用群组名称来指定           |
| h                                       | 不显示标题列                                                 |
| -H                                      | 显示树状结构，表示程序间的相互关系                           |
| -j或j                                   | 采用工作控制的格式显示程序状况                               |
| -l或l 小写L  因为ps没有-i或者-大写i选项 | 采用详细的格式来显示程序状况                                 |
| -L                                      | 显示线程                                                     |
| L                                       | 列出栏位的相关信息                                           |
| -m或m                                   | 显示所有的执行绪                                             |
| n                                       | 以数字来表示USER和WCHAN栏位                                  |
| -N                                      | 显示所有的程序，除了执行ps指令终端机下的程序之外             |
| -p <程序识别码>                         | 指定程序识别码，并列出该程序的状况                           |
| p <程序识别码>                          | 此选项的效果和指定”-p”选项相同，只在列表格式方面稍有差异     |
| r                                       | 只列出现行终端机正在执行中的程序                             |
| -s <阶段作业>                           | 指定阶段作业的程序识别码，并列出隶属该阶段作业的程序的状况   |
| s                                       | 采用程序信号的格式显示程序状况                               |
| S                                       | 列出程序时，包括已中断的子程序资料                           |
| o                                       | 指定用户定义的格式。与-o和--format相同。                     |
| -t <终端机编号>                         | 指定终端机编号，并列出属于该终端机的程序的状况               |
| t <终端机编号>                          | 此选项的效果和指定”-t”选项相同，只在列表格式方面稍有差异     |
| -T                                      | 显示现行终端机下的所有程序                                   |
| -u <用户识别码>                         | 此选项的效果和指定”-U”选项相同                               |
| u                                       | 以用户为主的格式来显示程序状况                               |
| -U <用户识别码>                         | 列出属于该用户的程序的状况，也可使用用户名称来指定           |
| U <用户名称>                            | 列出属于该用户的程序的状况                                   |
| v                                       | 采用虚拟内存的格式显示程序状况                               |
| -V或V                                   | 显示版本信息                                                 |
| -w或w                                   | 采用宽阔的格式来显示程序状况                                 |
| x                                       | 显示所有程序，不以终端机来区分                               |
| X                                       | 采用旧式的Linux i386登陆格式显示程序状况                     |
| -y                                      | 配合选项”-l”使用时，不显示F(flag)栏位，并以RSS栏位取代ADDR栏位 |
| -- <程序识别码>                         | 此选项的效果和指定”p”选项相同                                |
| --cols <每列字符数>                     | 设置每列的最大字符数                                         |
| --columns <每列字符数>                  | 此选项的效果和指定”--cols”选项相同                           |
| --cumulative                            | 此选项的效果和指定”S”选项相同                                |
| --deselect                              | 此选项的效果和指定”-N”选项相同                               |
| --forest                                | 此选项的效果和指定”f”选项相同                                |
| --headers                               | 重复显示标题列                                               |
| --help                                  | 在线帮助                                                     |
| --info                                  | 显示排错信息                                                 |
| --lines <显示列数>                      | 设置显示画面的列数                                           |
| --no-headers                            | 此选项的效果和指定”h”选项相同，只在列表格式方面稍有差异      |
| --group <群组名称>                      | 此选项的效果和指定”-G”选项相同                               |
| --Group <群组识别码>                    | 此选项的效果和指定”-G”选项相同                               |
| --pid <程序识别码>                      | 此选项的效果和指定”-p”选项相同                               |
| --rows <显示列数>                       | 此选项的效果和指定”--lines”选项相同                          |
| --sid <阶段作业>                        | 此选项的效果和指定”-s”选项相同                               |
| -tty <终端机编号>                       | 此选项的效果和指定”-t”选项相同                               |
| --user <用户名称>                       | 此选项的效果和指定”-U”选项相同                               |
| --User <用户识别码>                     | 此选项的效果和指定”-U”选项相同                               |
| --version                               | 此选项的效果和指定”-V”选项相同                               |
| --widty <每列字符数>                    | 此选项的效果和指定”-cols”选项相同                            |

#### 只打印R和D状态的线程

```bash
$ ps -e -L h o state,pid,ppid,ucmd:30,cmd:100,wchan:30  |awk  '{if($1=="R"||$1=="D"){print $0}}'
```

#### 只打印R和D状态的线程并按照线程数量排序

```bash
$ ps -e -L h o state,pid,ppid,ucmd:30,cmd:100,wchan:30  |awk  '{if($1=="R"||$1=="D"){print $0}}' | sort | uniq -c
```

#### 打印所有线程

```bash
$ ps -ALFlf  #这里是小写L,ps没有-i或者-大写i选项
```

打印线程占用CPU排序

```bash
$ ps -Leo pid,tid,class,rtprio,ni,pri,psr,pcpu,stat,wchan:30,comm | grep -v COMMAND | sort -k8nr
```

#### ps aux的解释

- ps a      显示现行终端机下的所有程序，包括其他用户的程序。
- ps u 　 以用户为主的格式来显示程序状况。
- ps x 　 显示所有程序，不以终端机来区分。

```bash
[root@tianyun ~]# ps aux |less
USER       PID %CPU %MEM    VSZ   RSS TTY     STAT START   TIME COMMAND
root         1     0.0     0.0          2164   648 ?          Ss   08:47     0:00 init [5]  
```

？表示不是终端启动的而是内核启动的进程

1. USER: 	运行进程的用户
2. PID： 	进程ID
3. %CPU:  CPU占用率       //1分钟占用率
4. %MEM: 内存占用率
5. VSZ：	占用虚拟内存
6. RSS:  	占用实际内存 驻留内存
7. TTY： 	进程运行的终端
8. STAT：	进程状态	 man ps (/STATE)
9. START:	进程的启动时间
10. TIME：	进程占用CPU的总时间
11. COMMAND： 进程文件，进程名



##### stat的各种状态含义	

- R 	是 Running 或 Runnable 的缩写，表示进程在 CPU 的就绪队列中，正在运行或者正在等待运行。
- S 	是 Interruptible Sleep 的缩写，也就是可中断状态睡眠，表示进程因为等待某个事件而被系统挂起。当进程等待的事件发生时，它会被唤醒并进入 R 状态。
- D	 是 Disk Sleep 的缩写，也就是不可中断状态睡眠（Uninterruptible Sleep），一般表示进程正在跟硬件交互，并且交互过程不允许被其他进程或中断打断。
- T 	表示进程处于暂停或者跟踪状态。向一个进程发送 SIGSTOP 信号，它就会因响应这个信号变成暂停状态（Stopped）；再向它发送 SIGCONT 信号，进程又会恢复运行（如果进程是终端里直接启动的，则需要你用 fg 命令，恢复到前台运行）。
- Z 	是 Zombie 的缩写，如果你玩过“植物大战僵尸”这款游戏，应该知道它的意思。它表示僵尸进程，也就是进程实际上已经结束了，但是父进程还没有回收它的资源（比如进程的描述符、PID 等）。       //不能有太多，有太多就不正常的
- I      是 Idle 的缩写，也就是空闲状态，用在不可中断睡眠的内核线程上。前面说了，硬件交互导致的不可中断进程用 D 表示，但对某些内核线程来说，它们有可能实际上并没有任何负载，用 Idle 正是为了区分这种情况。要注意，D 状态的进程会导致平均负载升高， I 状态的进程却不会。
- X    死掉的进程
- Ss      s进程的领导者，父进程
- S<     <优先级较高的进程
- SN    N优先级较低的进程
- R+    +表示是前台的进程组
- Sl	  以线程的方式运行      

##### 排序

自定义格式排序

```bash
$ ps -eo pid,user,args --sort user
```

按照标题进行排序

```bash
$ ps aux --sort %cpu             //从低往高排序  
$ ps aux --sort -%cpu            //从高往低排序
$ ps aux --sort rss 
$ ps aux --sort -rss 
$ ps aux --sort %mem
$ ps aux --sort -%mem
```

手动排序

```bash
使用内存前10
$ ps aux | sort -k4nr | head -n 10 
使用CPU前10
$ ps aux | sort -k3nr | head -n 10
```

!!! note

    比如说sort -k 1 -k 2 test.txt，那么就会根据test.txt文件中的第一列和第二列进行排序。
    -n：依照数值的大小排序；
    -r：以相反的顺序来排序






https://man7.org/linux/man-pages/man1/ps.1.html