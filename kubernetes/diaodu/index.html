
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://yinzhipeng123.github.io/markdown_log/kubernetes/diaodu/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.1.11">
    
    
      
        <title>亲和性 - MarkDown_Log</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3754935a.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nodeselector" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MarkDown_Log" class="md-header__button md-logo" aria-label="MarkDown_Log" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MarkDown_Log
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              亲和性
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/yinzhipeng123/markdown_log/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    MarkDown_Log
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MarkDown_Log" class="md-nav__button md-logo" aria-label="MarkDown_Log" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MarkDown_Log
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/yinzhipeng123/markdown_log/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    MarkDown_Log
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        MkDocs
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="MkDocs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          MkDocs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../api/MkDoc/" class="md-nav__link">
        MkDocs
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Prometheus
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Prometheus" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Prometheus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        Prometheus
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Prometheus" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Prometheus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/prometheus/" class="md-nav__link">
        单机部署
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/prometheus_k8s/" class="md-nav__link">
        K8S部署
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/kube-state-metrics/" class="md-nav__link">
        K8S kube-state-metrics指标说明
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/Exporter_Metrics/" class="md-nav__link">
        Exporter Metrics解释
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/query_xamples/" class="md-nav__link">
        Prometheus监控查询例子
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/query_rules/" class="md-nav__link">
        Prometheus监控查询语法入门
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/function/" class="md-nav__link">
        Prometheus语法函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/prometheus_recording_rule/" class="md-nav__link">
        Prometheus recording_rules功能
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/prometheus_rate/" class="md-nav__link">
        Prometheus指标讲解"为什么rate可以计算CPU的使用率"
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Alertmanager
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Alertmanager" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Alertmanager
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/prometheus/prometheus/" class="md-nav__link">
        Alertmanager部署
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/alertmanager/alertmanager_config/" class="md-nav__link">
        Alertmanager配置
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3">
        Grafana
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Grafana" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Grafana
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/grafana/grafana_install/" class="md-nav__link">
        Grafana部署
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/grafana/grafana_dashboard/" class="md-nav__link">
        Dashboard
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus/grafana/grafana_var/" class="md-nav__link">
        Grafana添加变量
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Etcd
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Etcd" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Etcd
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../etcd/etcd/" class="md-nav__link">
        etcd部署
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Python
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/basics/basic/" class="md-nav__link">
        Python一些语法
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/csv/" class="md-nav__link">
        CSV模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/xlxs/" class="md-nav__link">
        XLSX模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/k8s/" class="md-nav__link">
        K8S模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/mem/" class="md-nav__link">
        内存性能模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/python3_env/" class="md-nav__link">
        Centos7安装Python3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/python3_docker/" class="md-nav__link">
        Python3 Dokcer镜像制作
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/python_log/" class="md-nav__link">
        Python3 日志控制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/flask/flask_init/" class="md-nav__link">
        Flask
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Go
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Go" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Go
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../go/go_one/" class="md-nav__link">
        Go入门
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      <label class="md-nav__link" for="__nav_6_2">
        Web框架 Gin
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Web框架 Gin" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Web框架 Gin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../go/go_gin/" class="md-nav__link">
        Gin入门
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../go/gin_route/" class="md-nav__link">
        Gin 路由拆分成单个文件
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../go/gin__app_route/" class="md-nav__link">
        Gin 路由拆分成单独APP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        KubeSphere
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="KubeSphere" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          KubeSphere
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../KubeSphere/KubeSphere/" class="md-nav__link">
        KubeSphere安装
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Yum
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Yum" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Yum
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../yum/ius/" class="md-nav__link">
        ius源
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Centos7
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Centos7" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Centos7
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../centos7/ens33/" class="md-nav__link">
        修改网卡
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      <label class="md-nav__link" for="__nav_10">
        K8S
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="K8S" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          K8S
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes1.16/" class="md-nav__link">
        K8S 1.16.9部署
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dudian/" class="md-nav__link">
        污点
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        亲和性
      </a>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        Docker
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Docker" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_su/" class="md-nav__link">
        Docker
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/yinzhipeng123/markdown_log/edit/master/docs/kubernetes/diaodu.md" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="nodeselector">nodeSelector</h1>
<p>我们知道<code>label</code>是<code>kubernetes</code>中一个非常重要的概念，用户可以非常灵活的利用 label 来管理集群中的资源，比如最常见的一个就是 service 通过匹配 label 去选择 POD 的。而 POD 的调度也可以根据节点的 label 进行特定的部署。</p>
<p>我们可以通过下面的命令查看我们的 node 的 label：</p>
<pre><code class="language-shell">$ kubectl get nodes --show-labels
NAME            STATUS    ROLES     AGE       VERSION   LABELS
192.168.1.140   Ready     &lt;none&gt;    42d       v1.8.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=192.168.1.140
192.168.1.161   Ready     &lt;none&gt;    118d      v1.8.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/cluster-service=true,kubernetes.io/hostname=192.168.1.161
192.168.1.170   Ready     &lt;none&gt;    118d      v1.8.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/cluster-service=true,kubernetes.io/hostname=192.168.1.170
192.168.1.172   Ready     &lt;none&gt;    114d      v1.8.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/cluster-service=true,kubernetes.io/hostname=192.168.1.172
</code></pre>
<p>现在我们先给节点<strong>192.168.1.140</strong>增加一个<code>source=qikqiak</code>的标签，命令如下：</p>
<pre><code class="language-shell">$ kubectl label nodes 192.168.1.140 source=qikqiak
node &quot;192.168.1.140&quot; labeled
</code></pre>
<p>我们可以通过上面的<code>--show-labels</code>参数可以查看上述标签是否生效。当 node 被打上了相关标签后，在调度的时候就可以使用这些标签了，只需要在 POD 的 spec 字段中添加<code>nodeSelector</code>字段，里面是我们需要被调度的节点的 label。例如，下面是我们之前的一个默认的 busybox POD 的 YAML 文件：</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  labels:
    app: busybox-pod
  name: test-busybox
spec:
  containers:
  - command:
    - sleep
    - &quot;3600&quot;
    image: busybox
    imagePullPolicy: Always
    name: test-busybox
</code></pre>
<p>然后我需要让上面的 POD 被调度到140的节点上，那么最简单的方法就是去匹配140上面的 label，如下：</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  labels:
    app: busybox-pod
  name: test-busybox
spec:
  containers:
  - command:
    - sleep
    - &quot;3600&quot;
    image: busybox
    imagePullPolicy: Always
    name: test-busybox
  nodeSelector:
    source: qikqiak
</code></pre>
<p>然后我们可以通过 describe 命令查看调度结果：</p>
<pre><code class="language-shell">$ kubectl describe pod test-busybox
......
Events:
  Type    Reason                 Age   From                    Message
  ----    ------                 ----  ----                    -------
  Normal  Scheduled              49s   default-scheduler       Successfully assigned test-busybox to 192.168.1.140
  Normal  SuccessfulMountVolume  49s   kubelet, 192.168.1.140  MountVolume.SetUp succeeded for volume &quot;default-token-hmpbz&quot;
  Normal  Pulling                49s   kubelet, 192.168.1.140  pulling image &quot;busybox&quot;
  Normal  Pulled                 41s   kubelet, 192.168.1.140  Successfully pulled image &quot;busybox&quot;
  Normal  Created                41s   kubelet, 192.168.1.140  Created container
  Normal  Started                41s   kubelet, 192.168.1.140  Started container
</code></pre>
<p>我们可以看到 Events 下面的信息，上面的 POD 被正确的调度到了140节点。通过上面的例子我们可以感受到<code>nodeSelector</code>的方式比较直观，但是还够灵活，控制粒度偏大</p>
<h1 id="node-affinity">node affinity</h1>
<p>节点亲和性（node affinity）的概念与 <code>nodeSelector</code> 相似，可以基于节点的标签来限定 Pod 可以被调度到哪些节点上。</p>
<p>当前支持两种类型的节点亲和性， <code>requiredDuringSchedulingIgnoredDuringExecution</code> （hard，目标节点必须满足此条件） 以及 <code>preferredDuringSchedulingIgnoredDuringExecution</code> （soft，目标节点最好能满足此条件）。名字中 <code>IgnoredDuringExecution</code> 意味着：如果 Pod 已经调度到节点上以后，节点的标签发生改变，使得节点已经不再匹配该亲和性规则了，Pod 仍将继续在节点上执行（这一点与 <code>nodeSelector</code> 相似）。将来，Kubernetes 将会提供 <code>requiredDuringSchedulingRequiredDuringExecution</code> 这个选项，该选项与 <code>requiredDuringSchedulingIgnoredDuringExecution</code> 相似，不同的是，当节点的标签不在匹配亲和性规则之后，Pod 将被从节点上驱逐。</p>
<p><code>requiredDuringSchedulingIgnoredDuringExecution</code> 的一个例子是，<code>只在 Intel CPU 上运行该 Pod</code>，<code>preferredDuringSchedulingIgnoredDuringExecution</code> 的一个例子是，<code>尽量在高可用区 XYZ 中运行这个 Pod，但是如果做不到，也可以在其他地方运行该 Pod</code>。</p>
<p>PodSpec 中通过 <code>affinity.nodeAffinity</code> 字段来定义节点亲和性，示例文件如下：</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: with-node-affinity
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/e2e-az-name
            operator: In
            values:
            - e2e-az1
            - e2e-az2
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 1
        preference:
          matchExpressions:
          - key: another-node-label-key
            operator: In
            values:
            - another-node-label-value
  containers:
  - name: with-node-affinity
    image: k8s.gcr.io/pause:2.0
</code></pre>
<p>此处的亲和性规则表明，该 Pod 只能被调度到包含 key 为 <code>kubernetes.io/e2e-az-name</code> 且 value 为 <code>e2e-az1</code> 或 <code>e2e-az2</code> 的标签的节点上。此外，如果节点已经满足了前述条件，将优先选择包含 key 为 <code>another-node-label-key</code> 且 value 为 <code>another-node-label-value</code> 的标签的节点。</p>
<p>例子中使用了操作符 <code>In</code>。节点亲和性支持如下操作符：<code>In</code>、<code>NotIn</code>、<code>Exists</code>、<code>DoesNotExist</code>、<code>Gt</code>、<code>Lt</code>。使用 <code>NotIn</code> 和 <code>DoesNotExist</code> 可以实现节点反亲和性（node anti-affinity）的效果，或者也可以使用 <a href="https://kuboard.cn/learning/k8s-intermediate/config/taints-toleration/">污点</a> 为节点排斥某类 Pod。</p>
<ul>
<li>In：label 的值在某个列表中</li>
<li>NotIn：label 的值不在某个列表中</li>
<li>Gt：label 的值大于某个值</li>
<li>Lt：label 的值小于某个值</li>
<li>Exists：某个 label 存在</li>
<li>DoesNotExist：某个 label 不存在</li>
</ul>
<p>如果某个 Pod 同时指定了 <code>nodeSelector</code> 和 <code>nodeAffinity</code>，则目标节点必须同时满足两个条件，才能将 Pod 调度到该节点上。</p>
<p>如果为 <code>nodeAffinity</code> 指定多个 <code>nodeSelectorTerms</code>，则目标节点只需要满足任意一个 <code>nodeSelectorTerms</code> 的要求，就可以将 Pod 调度到该节点上。</p>
<p>如果为 <code>nodeSelectorTerms</code> 指定多个 <code>matchExpressions</code>，则目标节点必须满足所有的 <code>matchExpressions</code> 的要求，才能将 Pod 调度到该节点上。</p>
<p>当 Pod 被调度到某节点上之后，如果移除或者修改节点的标签，Pod 将仍然继续在节点上运行。换句话说，节点亲和性规则只在调度该 Pod 时发生作用。</p>
<p><code>preferredDuringSchedulingIgnoredDuringExecution</code> 中的 <code>weight</code> 字段取值范围为 1-100。对于每一个满足调度要求的节点（资源请求、亲和性/反亲和性规则，等），调度器将遍历该节点匹配的 <code>preferredDuringSchedulingIgnoredDuringExecution</code> 中所有的<code>weight</code> 并求和。此求和结果将与节点的其他优先级计算的得分合并。得分最高的节点被优先选择。</p>
<h1 id="pod">Pod亲和性与反亲和性</h1>
<p>Pod之间的亲和性与反亲和性（inter-pod affinity and anti-affinity）可以基于已经运行在节点上的 Pod 的标签（而不是节点的标签）来限定 Pod 可以被调度到哪个节点上。此类规则的表现形式是：</p>
<ul>
<li>
<p>当 X 已经运行了一个或者多个满足规则 Y 的 Pod 时，待调度的 Pod 应该（或者不应该 - 反亲和性）在 X 上运行</p>
</li>
<li>
<p>规则 Y 以 LabelSelector 的形式表述，附带一个可选的名称空间列表</p>
<blockquote>
<p>与节点不一样，Pod 是在名称空间中的（因此，Pod的标签是在名称空间中的），针对 Pod 的 LabelSelector 必须同时指定对应的名称空间</p>
</blockquote>
</li>
<li>
<p>X 是一个拓扑域的概念，例如节点、机柜、云供应商可用区、云供应商地域，等。X 以 <code>topologyKey</code> 的形式表达，该 Key代表了节点上代表拓扑域（topology domain）的一个标签。</p>
</li>
</ul>
<h2 id="pod-affinity">pod affinity 的一个例子</h2>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: with-pod-affinity
spec:
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: security
            operator: In
            values:
            - S1
        topologyKey: failure-domain.beta.kubernetes.io/zone
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: security
              operator: In
              values:
              - S2
          topologyKey: failure-domain.beta.kubernetes.io/zone
  containers:
  - name: with-pod-affinity
    image: k8s.gcr.io/pause:2.0

</code></pre>
<p>该 Pod 的 <code>affinity</code> 定义了一个 Pod 亲和性规则和一个 Pod 反亲和性规则，例子中， <code>podAffinity</code> 是 <code>requiredDuringSchedulingIgnoredDuringExecution</code>，而 <code>podAntiAffinity</code> 则是 <code>preferredDuringSchedulingIgnoredDuringExecution</code>。</p>
<ul>
<li>Pod 亲和性规则要求，该 Pod 可以被调度到的节点所在的可用区 <code>zone</code> 必须已经有一个已经运行的 Pod 包含标签 key=security，value=S1，或者更准确地说，节点必须满足如下条件：</li>
<li>节点包含 key 为 <code>failure-domain.beta.kubernetes.io/zone</code> 的标签，假设该标签的值为 <code>V</code></li>
<li>至少有一个包含 key 为 <code>failure-domain.beta.kubernetes.io/zone</code> 且 value 为 <code>V</code> 的标签的节点已经运行了一个包含标签 key 为 <code>security</code> 且 value 为 <code>S1</code> 的 Pod</li>
<li>Pod 反亲和性规则要求，该 Pod 最好不要被调度到已经运行了包含 key 为 <code>security</code> 且 value 为 <code>S2</code> 的标签的 Pod 的节点上，或者更准确地说，必须满足如下条件：</li>
<li>如果 <code>topologyKey</code> 是 <code>failure-domain.beta.kubernetes.io/zone</code>，则，Pod不能被调度到同一个 zone 中的已经运行了包含标签 <code>security: S2</code> 的节点上</li>
</ul>
<p>参考 <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/scheduling/podaffinity.md">design doc (opens new window)</a>可以了解更多 Pod 亲和性与反亲和性的例子。</p>
<p>原则上， <code>topologyKey</code> 可以是任何合法的标签 key。然而，处于性能和安全的考虑，仍然对 <code>topologyKey</code> 有如下限制：</p>
<ol>
<li>对亲和性以及 <code>requiredDuringSchedulingIgnoredDuringExecution</code> Pod 反亲和性，<code>topologyKey</code> 不能为空</li>
<li>对 <code>requiredDuringSchedulingIgnoredDuringExecution</code> Pod 反亲和性，管理控制器 <code>LimitPodHardAntiAffinityTopology</code> 被用来限制 <code>topologyKey</code> 必须为 <code>kubernetes.io/hostname</code>。如果想要使用其他的自定义 topology，必须修改该管理控制器，或者将其禁用</li>
<li>对 <code>preferredDuringSchedulingIgnoredDuringExecution</code> Pod 反亲和性，如果 <code>topologyKey</code> 为空，则代表所有的 topology （此时，不局限于 <code>kubernetes.io/hostname</code>、<code>failure-domain.beta.kubernetes.io/zone</code> 和 <code>failure-domain.beta.kubernetes.io/region</code> 的组合）</li>
<li>除了上述的情形以外，<code>topologyKey</code> 可以是任何合法的标签 Key</li>
</ol>
<p>除了 <code>labelSelector</code> 和 <code>topologyKey</code> 以外，还可以指定一个 <code>namespaces</code> 的列表，用作 <code>labelSelector</code> 的作用范围（与 <code>labelSelector</code> 和 <code>topologyKey</code> 的定义为同一个级别）。如果不定义或者该字段为空，默认为 Pod 所在的名称空间。</p>
<p>所有与 <code>requiredDuringSchedulingIgnoredDuringExecution</code> 亲和性和反亲和性关联的 <code>matchExpressions</code> 必须被满足，Pod 才能被调度到目标节点。</p>
<h1 id="topologykey">什么是topologyKey</h1>
<p>顾名思义，<code>topology</code> 就是 <code>拓扑</code> 的意思，这里指的是一个 <code>拓扑域</code>，是指一个范围的概念，比如一个 Node、一个机柜、一个机房或者是一个地区（如杭州、上海）等，实际上对应的还是 Node 上的标签。这里的 <code>topologyKey</code> 对应的是 Node 上的标签的 Key（没有Value），可以看出，其实 <code>topologyKey</code> 就是用于筛选 Node 的。通过这种方式，我们就可以将各个 Pod 进行跨集群、跨机房、跨地区的调度了。</p>
<h2 id="topologykey_1">如何使用topologyKey</h2>
<p>看下面的例子：</p>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: with-pod-affinity
spec:
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: security
            operator: In
            values:
            - S1
        topologyKey: failure-domain.beta.kubernetes.io/zone
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: security
              operator: In
              values:
              - S2
          topologyKey: kubernetes.io/hostname
  containers:
  - name: with-pod-affinity
    image: k8s.gcr.io/pause:2.0
</code></pre>
<p>这里 Pod 的亲和性规则是：这个 Pod 要调度到的 Node 必须有一个标签为 <code>security: S1</code> 的 Pod，且该 Node 必须有一个 Key 为 <code>failure-domain.beta.kubernetes.io/zone</code> 的 标签，即 Node 必须属于 <code>failure-domain.beta.kubernetes.io/zone</code> 拓扑域。</p>
<p>Pod 的反亲和性规则是：这个 Pod 尽量不要调度到这样的 Node，其包含一个 Key 为 <code>kubernetes.io/hostname</code> 的标签，且该 Node 上有标签为 <code>security: S2</code> 的 Pod。</p>
<h2 id="topologykey_2">topologyKey详解</h2>
<p>既然 <code>topologyKey</code> 是拓扑域，那 Pod 之间怎样才是属于同一个拓扑域？</p>
<p>如果使用 <code>k8s.io/hostname</code>，则表示拓扑域为 Node 范围，那么 <code>k8s.io/hostname</code> 对应的值不一样就是不同的拓扑域。比如 Pod1 在 <code>k8s.io/hostname=node1</code> 的 Node 上，Pod2 在 <code>k8s.io/hostname=node2</code> 的 Node 上，Pod3 在 <code>k8s.io/hostname=node1</code> 的 Node 上，则 Pod2 和 Pod1、Pod3 不在同一个拓扑域，而Pod1 和 Pod3在同一个拓扑域。</p>
<p>如果使用 <code>failure-domain.k8s.io/zone</code> ，则表示拓扑域为一个区域。同样，Node 的标签 <code>failure-domain.k8s.io/zone</code> 对应的值不一样也不是同一个拓扑域，比如 Pod1 在 <code>failure-domain.k8s.io/zone=beijing</code> 的 Node 上，Pod2 在 <code>failure-domain.k8s.io/zone=hangzhou</code> 的 Node 上，则 Pod1 和 Pod2 不属于同一个拓扑域。</p>
<p>当然，topologyKey 也可以使用自定义标签。比如可以给一组 Node 打上标签 <code>custom_topology</code>，那么拓扑域就是针对这个标签了，则该标签相同的 Node 上的 Pod 属于同一个拓扑域。</p>
<h2 id="_1">注意事项</h2>
<p>原则上，topologyKey 可以是任何合法的标签 Key。但是出于性能和安全原因，对 topologyKey 有一些限制：</p>
<ol>
<li>对于亲和性和 <code>requiredDuringSchedulingIgnoredDuringExecution</code> 的 Pod 反亲和性，topologyKey 不能为空。</li>
<li>对于 <code>requiredDuringSchedulingIgnoredDuringExecution</code> 的 Pod 反亲和性，引入 <code>LimitPodHardAntiAffinityTopology</code> 准入控制器来限制 topologyKey 只能是 <code>kubernetes.io/hostname</code>。如果要使用自定义拓扑域，则可以修改准入控制器，或者直接禁用它。</li>
<li>对于 <code>preferredDuringSchedulingIgnoredDuringExecution</code> 的 Pod 反亲和性，空的 topologyKey 表示所有拓扑域。截止 <code>v1.12</code> 版本，所有拓扑域还只能是 <code>kubernetes.io/hostname</code>、<code>failure-domain.beta.kubernetes.io/zone</code> 和 <code>failure-domain.beta.kubernetes.io/region</code> 的组合。</li>
<li>除上述情况外，topologyKey 可以是任何合法的标签 key。</li>
</ol>
<h1 id="_2">更多实用的例子</h1>
<p>Pod 亲和性与反亲和性结合高级别控制器（例如 ReplicaSet、StatefulSet、Deployment 等）一起使用时，可以非常实用。此时可以很容易的将一组工作复杂调度到同一个 topology，例如，同一个节点。</p>
<h4 id="_3">始终在同一个节点始终在同一个节点</h4>
<p>在一个三节点的集群中，部署一个使用 redis 的 web 应用程序，并期望 web-server 尽可能与 redis 在同一个节点上。</p>
<p>下面是 redis deployment 的 yaml 片段，包含三个副本以及 <code>app=store</code> 标签选择器。Deployment 中配置了 <code>PodAntiAffinity</code>，确保调度器不会将三个副本调度到一个节点上：</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis-cache
spec:
  selector:
    matchLabels:
      app: store
  replicas: 3
  template:
    metadata:
      labels:
        app: store
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - store
            topologyKey: &quot;kubernetes.io/hostname&quot;
      containers:
      - name: redis-server
        image: redis:3.2-alpine
</code></pre>
<p>下面是 webserver deployment 的 yaml 片段，配置了 <code>podAntiAffinity</code> 以及 <code>podAffinity</code>。要求将其副本与 包含 <code>app=store</code> 标签的 Pod 放在同一个节点上；同时也要求 web-server 的副本不被调度到同一个节点上。</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-server
spec:
  selector:
    matchLabels:
      app: web-store
  replicas: 3
  template:
    metadata:
      labels:
        app: web-store
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - web-store
            topologyKey: &quot;kubernetes.io/hostname&quot;
        podAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - store
            topologyKey: &quot;kubernetes.io/hostname&quot;
      containers:
      - name: web-app
        image: nginx:1.12-alpine
</code></pre>
<p>如果创建上述两个 deployment，集群将如下所示：</p>
<table>
<thead>
<tr>
<th>Node-1</th>
<th>Node-2</th>
<th>Node-3</th>
</tr>
</thead>
<tbody>
<tr>
<td>web-server-1</td>
<td>webserver-2</td>
<td>webserver-3</td>
</tr>
<tr>
<td>cache-1</td>
<td>cache-2</td>
<td>cache-3</td>
</tr>
</tbody>
</table>
<p><code>web-server</code> 的三个副本都自动与 cach 的副本运行在相同的节点上。</p>
<pre><code class="language-sh">kubectl get pods -o wide
</code></pre>
<p>输出结果如下所示</p>
<pre><code class="language-text">NAME                           READY     STATUS    RESTARTS   AGE       IP           NODE
redis-cache-1450370735-6dzlj   1/1       Running   0          8m        10.192.4.2   kube-node-3
redis-cache-1450370735-j2j96   1/1       Running   0          8m        10.192.2.2   kube-node-1
redis-cache-1450370735-z73mh   1/1       Running   0          8m        10.192.3.1   kube-node-2
web-server-1287567482-5d4dz    1/1       Running   0          7m        10.192.2.3   kube-node-1
web-server-1287567482-6f7v5    1/1       Running   0          7m        10.192.4.3   kube-node-3
web-server-1287567482-s330j    1/1       Running   0          7m        10.192.3.2   kube-node-2
</code></pre>
<h4 id="_4">始终不在相同的节点上</h4>
<p>上面的例子使用了 <code>PodAntiAffinity</code> 规则与 <code>topologyKey: "kubernetes.io/hostname"</code> 来部署 redis 集群，因此没有任何两个副本被调度到同一个节点上。参考 <a href="https://kubernetes.io/docs/tutorials/stateful-application/zookeeper/#tolerating-node-failure">ZooKeeper tutorial (opens new window)</a>了解如何使用相同的方式为 StatefulSet 配置反亲和性以实现高可用。</p>
<p>http://bazingafeng.com/2019/03/31/k8s-affinity-topologykey/</p>
<p>https://kuboard.cn/learning/k8s-intermediate/config/affinity.html</p>
                
              
              
                


<!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC81NDU5Ni8zMTA2Nw==">
<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->

              
              <span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span>
              <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span>
              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../dudian/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 污点" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              污点
            </div>
          </div>
        </a>
      
      
        
        <a href="../../docker/docker_su/" class="md-footer__link md-footer__link--next" aria-label="下一页: Docker" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              Docker
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            MarkDown_Log - Documentation
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.ddd52ceb.min.js"></script>
      
        <script src="//busuanzi.ibruce.info//busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>